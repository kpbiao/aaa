(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{"MC/a":function(e,t,o){"use strict";o.r(t);var a=o("2/Rp"),n=o("bx4M"),r=o("kPKH"),s=o("Vl3Y"),i=o("5rEg"),c=o("kLXV"),u=o("BMrR"),l=o("gD9s"),d=o("1f+Y"),p=o("H4Ev"),f=o("ayp/"),m=o("SvbV"),h=o("q1tI"),g=o("peh1"),y=o("W9HT"),v=o("iopk"),b=o.n(v);function S(e){return(S="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function D(){return(D=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(e[a]=o[a])}return e}).apply(this,arguments)}function E(e,t){for(var o=0;o<t.length;o++){var a=t[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function k(e,t){return!t||"object"!==S(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function F(e,t){return(F=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var C=s.a.Item,T=c.a.confirm,A={sm:24,xs:24,md:6,lg:6,xl:6},N=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=k(this,O(t).call(this,e))).selectedAddress=void 0,o.onChangeCustomer=function(e){""===o.state.selectCustomer&&o.setState({selectCustomer:e})},o.state={loadIndex:0,loadType:0,loadData:{},unloadData:[],selectCustomer:""},o}var o,c,g;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&F(e,t)}(t,h["PureComponent"]),o=t,(c=[{key:"componentDidMount",value:function(){var e=this,t=this.props,o=t.searchParams;t.form;o.id&&this.props.getRoute(Number(o.id)),this.props.eventEmitter.on("close",function(t,o){"FROM_TAB_CLOSE"===o||"FROM_TAB_REFRESH"===o?e.cancleEdit(t):t()})}},{key:"componentWillReceiveProps",value:function(e){if(e.saveData&&e.saveData!==this.props.saveData){var t=this.props.searchParams.id;this.toSchedule(t||e.saveData)}e.routeData.size&&!this.props.routeData.size&&this.setFormData(e)}},{key:"render",value:function(){var e=this,t=this.props.loading;return h.createElement("div",{className:b.a.FixpathAddpath},h.createElement(y.a,{spinning:t},h.createElement(s.a,{layout:"horizontal"},this.renderBasicInfo(),h.createElement(m.a,{form:this.props.form}),h.createElement(f.a,{rightChild:h.createElement(f.b,{buttons:[h.createElement(a.a,{key:1,onClick:function(){e.cancleEdit()}},"\u53d6\u6d88"),h.createElement(a.a,{key:2,type:"primary",htmlType:"submit",onClick:function(){e.onHandleSubmit()}},"\u4fdd\u5b58\u7ebf\u8def")]})}))))}},{key:"renderBasicInfo",value:function(){var e=this,t=this.props.form,o=t.getFieldDecorator,a=(t.setFieldsValue,this.state),s=a.loadData,c=a.unloadData,f={closeAddressModal:function(t,o,a){e.closeAddressModal(t,o,a)},showAddressModal:function(t,o){e.showAddressModal(t,o)},form:this.props.form};return h.createElement(n.a,{title:"\u57fa\u672c\u4fe1\u606f"},h.createElement(u.a,{gutter:16},h.createElement(r.a,A,h.createElement(C,{label:"",type:"hidden",style:{margin:0}},o("customerCode")(h.createElement(i.a,{type:"hidden"}))),h.createElement(C,{label:"\u9009\u62e9\u5ba2\u6237"},o("customerName",{rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u5ba2\u6237"}]})(h.createElement(d.a,{onChange:this.onChangeCustomer})))),h.createElement(r.a,A,h.createElement(C,{label:"\u7ebf\u8def\u540d\u79f0"},o("routeName",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u7ebf\u8def\u540d\u79f0"}]})(h.createElement(i.a,{placeholder:"\u7ebf\u8def\u540d\u79f0",maxLength:50})))),h.createElement(r.a,A,h.createElement(C,{label:"\u6240\u9700\u8f66\u578b",required:!0},o("carStruct",{rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u8f66\u578b"}]})(h.createElement(l.a,{placeholder:"\u8bf7\u9009\u62e9\u8f66\u578b",maxSelect:1,style:{marginTop:"6px"}}))))),h.createElement(p.a,D({fields:{name:"load",value:[s]},loadtype:0},f)),h.createElement(p.a,D({fields:{name:"unload",value:c},loadtype:1},f,{onDele:function(t){e.deleUnloadData(t)}})))}},{key:"showAddressModal",value:function(e,t){this.setState({loadType:e,loadIndex:t})}},{key:"closeAddressModal",value:function(e,t,o){var a=this.props.form,n=this.state,r=n.loadIndex,s=n.unloadData;if(0===o)a.setFieldsValue({load:[t]}),this.setState({loadData:e});else if(1===o){s[r]=e;var i=a.getFieldValue("unload");i[r]=t,a.setFieldsValue({unload:i}),this.setState({unloadData:s})}}},{key:"deleUnloadData",value:function(e){var t=this.state.unloadData;t[e]=null,this.setState({unloadData:t})}},{key:"onHandleSubmit",value:function(){var e=this;this.props.form.validateFields(function(t,o){if(!t){var a=e.getSubmitData();e.props.saveRouteConfig(a)}})}},{key:"getSubmitData",value:function(){var e=this.state,t=e.loadData,o=e.unloadData,a=(0,this.props.form.getFieldsValue)(),n=[Object.assign({},a.load[0],t)].concat(o.map(function(e,t){if(e&&a.unload[t])return Object.assign({},a.unload[t],e)})),r=a.customerName,s=Object.assign(a,{carLong:a.carStruct[0].vehicleLong,carStruct:a.carStruct[0].vehicleType,routeWayPoints:JSON.stringify(n).toString()});return delete s.load,delete s.unload,delete s.unloadKeys,r&&r.indexOf(",")>0?Object.assign(s,{customerCode:r.split(",")[0],customerName:r.split(",")[1]}):s}},{key:"cancleEdit",value:function(e){var t=this,o=this.props,a=o.form,n=o.searchParams,r=o.routeData,s=this.state.selectCustomer,i=["routeName","load","load[0].pointAddress","load[0].contact","load[0].phone","unload","goodsName","goodsWeight","goodsVolume","goodsNumber","isReceipt","collictionAmount","customerFreight","driverFreight"];a.getFieldValue("unloadKeys").map(function(e){i.push("unload[".concat(e,"].pointAddress")),i.push("unload[".concat(e,"].contact")),i.push("unload[".concat(e,"].phone"))});var c=!1;if(n.id){var u=r.get("carLong")/1e3+"\u7c73"+r.get("carStruct");(a.isFieldsTouched(i)||u!==a.getFieldValue("carStruct")[0].value)&&(c=!0)}else i.push("carStruct"),(s!==a.getFieldValue("customerName")||a.isFieldsTouched(i))&&(c=!0);c?T({title:"\u6709\u672a\u4fdd\u5b58\u7684\u4fe1\u606f",content:"\u5982\u653e\u5f03\uff0c\u586b\u5199\u7684\u4fe1\u606f\u5c06\u4e22\u5931",okText:"\u7ee7\u7eed\u586b\u5199",cancelText:"\u653e\u5f03",centered:!0,onCancel:function(){e?e():t.toList()}}):e?e():this.toList()}},{key:"toList",value:function(){this.props.toList(),this.props.close()}},{key:"toSchedule",value:function(e){var t=this,o=!!this.props.searchParams.id;T({title:"".concat(o?"\u4fee\u6539":"\u521b\u5efa","\u6210\u529f"),content:"\u7ebf\u8def".concat(o?"\u4fee\u6539":"\u521b\u5efa","\u6210\u529f\uff0c\u662f\u5426\u7acb\u523b\u8bbe\u7f6e\u8fd0\u529b\u8ba1\u5212"),okText:"\u8bbe\u7f6e\u8fd0\u529b",cancelText:"\u6682\u4e0d\u8bbe\u7f6e",centered:!0,iconType:"check-circle",onOk:function(){t.props.toSchedule(e),t.props.refresh("/fixpath/list"),t.props.close()},onCancel:function(){t.props.toList(),t.props.refresh("/fixpath/list"),t.props.close()}})}},{key:"setFormData",value:function(e){var t=e.routeData,o=e.form,a=t.get("routeWayPoints").filter(function(e){return 1===e.get("loadType")||"1"===e.get("loadType")}).toJS(),n=t.get("routeWayPoints").filter(function(e){return 0===e.get("loadType")||"0"===e.get("loadType")}).toJS()[0],r=t.get("carLong")/1e3+"\u7c73"+t.get("carStruct");t.size&&(o.setFieldsValue({routeName:t.get("routeName"),customerName:t.get("customerName"),customerCode:t.get("customerCode"),carStruct:[{value:r}],goodsName:t.get("goodsName"),goodsNumber:t.get("goodsNumber"),goodsVolume:t.get("goodsVolume"),goodsWeight:t.get("goodsWeight"),isReceipt:t.get("isReceipt").toString(),customerFreight:t.get("customerFreight"),driverFreight:t.get("driverFreight"),collictionAmount:t.get("collictionAmount"),unloadKeys:a.map(function(e,t){return t}),load:[{pointAddress:n.pointAddress,phone:n.phone,contact:n.contact}]}),setTimeout(function(){o.setFieldsValue({unload:a.map(function(e){return{pointAddress:e.pointAddress,phone:e.phone,contact:e.contact}})})},0),this.setState({loadData:n,unloadData:a}))}}])&&E(o.prototype,c),g&&E(o,g),t}();t.default=function(e){var t=e.routeId;return(0,e.connectModel)(function(e){var o,a=function(e){return e.get(t)};return{mapStateToProps:Object(g.createStructuredSelector)({routeData:(o=a,Object(g.createSelector)(o,function(e){return e.get("data")})),error:function(e){return Object(g.createSelector)(e,function(e){return e.get("error")})}(a),loading:function(e){return Object(g.createSelector)(e,function(e){return e.get("loading")})}(a),saveData:function(e){return Object(g.createSelector)(e,function(e){return e.get("saveData")})}(a)}),mapDispatchToProps:function(t){return{getRoute:function(o){return t(e.getRoute(o))},saveRouteConfig:function(o){return t(e.saveRouteConfig(o))},toList:function(o){return t(e.toList(o))},toSchedule:function(o){return t(e.toSchedule(o))}}}}})(s.a.create()(N))}},iopk:function(e,t,o){}}]);
//# sourceMappingURL=fixpath-addpath.e2bd7303.chunk.js.map