(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{"8MUU":function(e,t,r){e.exports={VehicleOrderAdd:"_1w8-g"}},dV2L:function(e,t,r){"use strict";r.r(t);var a=r("q1tI"),o=r("peh1"),n=r("2/Rp"),i=r("bx4M"),s=r("kPKH"),c=r("+eQT"),l=r("Vl3Y"),u=r("5rEg"),d=r("kLXV"),m=r("BMrR"),p=r("W9HT"),f=r("gD9s"),h=r("1f+Y"),g=r("H4Ev"),y=r("ayp/"),v=r("qrex"),b=r("wd/R"),D=r.n(b),S=r("dZay"),E=r.n(S),O=r("SvbV"),C=r("8MUU"),k=r.n(C);function T(e){return(T="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function F(){return(F=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function w(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function A(e,t){return!t||"object"!==T(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function M(e){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function V(e,t){return(V=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var j=l.a.Item,L=d.a.confirm,x={sm:24,xs:24,md:6,lg:6,xl:6},P=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=A(this,M(t).call(this,e))).selectedAddress=void 0,r.onChangeCustomer=function(e){""===r.state.selectCustomer&&r.setState({selectCustomer:e})},r.state={showAddress:!1,loadIndex:0,loadType:0,loadData:{},unloadData:[],selectCustomer:""},r}var r,o,d;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&V(e,t)}(t,a["PureComponent"]),r=t,(o=[{key:"componentDidMount",value:function(){var e=this,t=this.props.searchParams;t.id&&this.props.getOrder(Number(t.id)),this.props.eventEmitter.on("close",function(t,r){"FROM_TAB_CLOSE"===r||"FROM_TAB_REFRESH"===r?e.cancleEdit(t):t()})}},{key:"componentWillReceiveProps",value:function(e){e.saveData&&e.saveData!==this.props.saveData&&this.sendGoods(e.saveData),e.orderDetail&&e.orderDetail!==this.props.orderDetail&&this.setFormData(e)}},{key:"render",value:function(){var e=this,t=this.props.loading,r=this.props.searchParams.id;return a.createElement("div",{className:k.a.VehicleOrderAdd,onSubmit:function(t){e.onHandleSubmit(t)}},a.createElement(p.a,{spinning:t},a.createElement(l.a,{layout:"horizontal"},this.renderBasicInfo(),a.createElement(O.a,{form:this.props.form}),a.createElement(y.a,{rightChild:a.createElement(y.b,{buttons:[a.createElement(n.a,{key:1,onClick:function(){e.cancleEdit()}},"\u53d6\u6d88"),a.createElement(n.a,{key:2,type:"primary",htmlType:"submit"},r?"\u4fdd\u5b58":"\u786e\u8ba4\u5f00\u5355")]})}))))}},{key:"renderBasicInfo",value:function(){var e=this,t=this.props.form,r=t.getFieldDecorator,o=t.setFieldsValue,n=this.props,l=n.searchParams,d=(n.orderDetail,this.state),p=d.loadData,y=d.unloadData,b={closeAddressModal:function(t,r,a){e.closeAddressModal(t,r,a)},showAddressModal:function(t,r){e.showAddressModal(t,r)},form:this.props.form},S={showTime:{format:"HH:mm",hideDisabledOptions:!0,minuteStep:10},format:"YYYY-MM-DD HH:mm",style:{width:"100%"},disabledDate:function(e){return e<D()()},disabledTime:function(t){return{disabledHours:function(){return D()(t).isSame(D()(),"day")?e.range(0,D()().add(2,"h").hour()):[]},disabledMinutes:function(){return D()(t).isSame(D()().add(2,"h"),"hour")?e.range(0,D()().minute()):[]},disabledSeconds:function(){return[]}}}};return a.createElement(i.a,{title:"\u57fa\u672c\u4fe1\u606f"},a.createElement(m.a,{gutter:16},a.createElement(s.a,x,a.createElement(j,{label:"",type:"hidden",style:{margin:0}},r("customerCode")(a.createElement(u.a,{type:"hidden"}))),a.createElement(j,{label:"\u9009\u62e9\u5ba2\u6237"},r("customerName")(a.createElement(h.a,{disabled:!!l.id,onChange:this.onChangeCustomer})))),a.createElement(s.a,x,a.createElement(j,{label:"\u7b2c\u4e09\u65b9\u8ba2\u5355\u53f7"},r("thirdSystemId")(a.createElement(u.a,{placeholder:"\u8bf7\u8f93\u5165\u7b2c\u4e09\u65b9\u8ba2\u5355\u53f7",disabled:!!l.id,maxLength:30}))))),a.createElement(m.a,{gutter:16},a.createElement(s.a,x,a.createElement(j,{label:"\u6240\u9700\u8f66\u578b",required:!0},r("carStruct",{rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u8f66\u578b"}]})(a.createElement(f.a,{placeholder:"\u8bf7\u9009\u62e9\u8f66\u578b",maxSelect:1}))))),a.createElement(m.a,{gutter:16},a.createElement(s.a,x,a.createElement(j,{label:"\u7528\u8f66\u65f6\u95f4",required:!0},r("useCarDate",{initialValue:D()().add(2,"h"),rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u7528\u8f66\u65f6\u95f4"}]})(a.createElement(c.a,F({},S,{onChange:function(e,t){D()(e).isBefore(D()().add(2,"h"),"minute")&&setTimeout(function(){o({useCarDate:D()(e).add(2,"h")})},0)}}))))),a.createElement(s.a,x,a.createElement(j,{label:"\u8981\u6c42\u9001\u8fbe\u65f6\u95f4"},r("requireDate")(a.createElement(c.a,F({},S,{disabledDate:function(e){return e<D()().add(2,"h")},showToday:!1})))))),a.createElement(g.a,F({fields:{name:"load",value:[p]},loadtype:0},b)),a.createElement(g.a,F({fields:{name:"unload",value:y},loadtype:1},b,{onDele:function(t){e.deleUnloadData(t)}})),a.createElement(m.a,{gutter:16},a.createElement(s.a,x,a.createElement(j,{label:"\u5907\u6ce8"},r("remark")(a.createElement(v.a,{maxLength:500,placeholder:"\u8bf7\u8f93\u5165\u5907\u6ce8"}))))))}},{key:"range",value:function(e,t){for(var r=[],a=e;a<t;a++)r.push(a);return r}},{key:"showAddressModal",value:function(e,t){this.setState({loadType:e,loadIndex:t})}},{key:"closeAddressModal",value:function(e,t,r){var a=this.props.form,o=this.state.loadIndex;if(0===r)a.setFieldsValue({load:[t]}),this.setState({loadData:e});else if(1===r){var n=this.state.unloadData;n[o]=e;var i=a.getFieldValue("unload");i[o]=t,a.setFieldsValue({unload:i}),this.setState({unloadData:n})}}},{key:"deleUnloadData",value:function(e){var t=this.state.unloadData;t[e]=null,this.setState({unloadData:t})}},{key:"cancleEdit",value:function(e){var t=this,r=this.props,a=r.form,o=r.searchParams,n=r.orderDetail,i=this.state.selectCustomer,s=["thirdSystemId","useCarDate","requireDate","remark","load","load[0].pointAddress","load[0].contact","load[0].phone","unload","goodsName","goodsWeight","goodsVolume","goodsNumber","isReceipt","collictionAmount","customerFreight","driverFreight"];a.getFieldValue("unloadKeys").map(function(e){s.push("unload[".concat(e,"].pointAddress")),s.push("unload[".concat(e,"].contact")),s.push("unload[".concat(e,"].phone"))});var c=!1;if(o.id){var l=n.get("carLong")/1e3+"\u7c73"+n.get("carStruct");(a.isFieldsTouched(s)||l!==a.getFieldValue("carStruct")[0].value)&&(c=!0)}else s.push("carStruct"),(i!==a.getFieldValue("customerName")||a.isFieldsTouched(s))&&(c=!0);c?L({title:"\u6709\u672a\u4fdd\u5b58\u7684\u4fe1\u606f",content:"\u5982\u653e\u5f03\uff0c\u586b\u5199\u7684\u4fe1\u606f\u5c06\u4e22\u5931",okText:"\u7ee7\u7eed\u586b\u5199",cancelText:"\u653e\u5f03",centered:!0,onCancel:function(){e?e():t.toList()}}):e?e():this.toList()}},{key:"sendGoods",value:function(e){var t=this,r=!!this.props.searchParams.id;L({title:"".concat(r?"\u4fee\u6539":"\u5f00\u5355","\u6210\u529f"),content:"\u6574\u8f66".concat(r?"\u4fee\u6539":"\u5f00\u5355","\u6210\u529f\uff0c\u662f\u5426\u76f4\u63a5\u53d1\u8d27\uff0c\u8c03\u5ea6\u53f8\u673a\u3002"),okText:"\u5b8c\u6210\u53d1\u8d27",cancelText:"\u665a\u70b9\u518d\u8bf4",iconType:"check-circle",centered:!0,onOk:function(){t.props.sendGood({orderWholeCarId:e,handleClose:t.props.close})},onCancel:function(){t.toList()}})}},{key:"toList",value:function(){this.props.toList(),E()("/vehicleOrder/list","refresh").emit(!0),this.props.close()}},{key:"onHandleSubmit",value:function(e){var t=this;e.preventDefault(),this.props.form.validateFields(function(e,r){if(!e){var a=t.getSubmitData();t.props.saveOrderConfig(a)}})}},{key:"getSubmitData",value:function(){var e=this.state,t=e.loadData,r=e.unloadData,a=(0,this.props.form.getFieldsValue)(),o=[Object.assign({},a.load[0],t)].concat(r.map(function(e,t){if(e&&e.pointAddress&&a.unload[t]&&a.unload[t].pointAddress)return Object.assign({},e,a.unload[t])}).filter(function(e){return e&&e.pointAddress})),n=a.customerName,i=Object.assign({},a,{useCarDate:a.useCarDate?a.useCarDate.format("YYYY-MM-DD HH:mm:00"):"",requireDate:a.requireDate?a.requireDate.format("YYYY-MM-DD HH:mm:00"):"",carLong:a.carStruct[0].vehicleLong,carStruct:a.carStruct[0].vehicleType,loadList:o});return delete i.load,delete i.unload,delete i.unloadKeys,n&&n.indexOf(",")>0?Object.assign(i,{customerCode:n.split(",")[0],customerName:n.split(",")[1]}):i}},{key:"setFormData",value:function(e){var t=e.orderDetail,r=e.form,a=t.get("loadList").filter(function(e){return 1===e.get("loadType")||"1"===e.get("loadType")}).toJS(),o=t.get("loadList").filter(function(e){return 0===e.get("loadType")||"0"===e.get("loadType")}).toJS()[0],n=t.get("carLong")/1e3+"\u7c73"+t.get("carStruct");t.size&&(r.setFieldsValue({customerName:t.get("customerName"),customerCode:t.get("customerCode"),thirdSystemId:t.get("thirdSystemId"),carStruct:[{value:n}],useCarDate:t.get("useCarDate")?D()(t.get("useCarDate")):D()().add(2,"h"),requireDate:t.get("requireDate")?D()(t.get("requireDate")):"",goodsName:t.get("goodsName"),goodsNumber:t.get("goodsNumber"),goodsVolume:t.get("goodsVolume"),goodsWeight:t.get("goodsWeight"),remark:t.get("remark"),isReceipt:t.get("isReceipt").toString(),customerFreight:t.get("customerFreight"),driverFreight:t.get("driverFreight"),collictionAmount:t.get("collictionAmount"),unloadKeys:a.map(function(e,t){return t}),load:[{pointAddress:o.pointAddress,phone:o.phone,contact:o.contact}]}),setTimeout(function(){r.setFieldsValue({unload:a.map(function(e){return{pointAddress:e.pointAddress,phone:e.phone,contact:e.contact}})})},0),this.setState({loadData:o,unloadData:a}))}}])&&w(r.prototype,o),d&&w(r,d),t}();t.default=function(e){var t=e.routeId;return(0,e.connectModel)(function(e){var r,a=function(e){return e.get(t)};return{mapStateToProps:Object(o.createStructuredSelector)({orderDetail:(r=a,Object(o.createSelector)(r,function(e){return e.get("data")})),saveData:function(e){return Object(o.createSelector)(e,function(e){return e.get("saveData")})}(a),sendData:function(e){return Object(o.createSelector)(e,function(e){return e.get("sendData")})}(a),error:function(e){return Object(o.createSelector)(e,function(e){return e.get("error")})}(a),loading:function(e){return Object(o.createSelector)(e,function(e){return e.get("loading")})}(a)}),mapDispatchToProps:function(t){return{getOrder:function(r){return t(e.getOrder(r))},saveOrderConfig:function(r){return t(e.saveOrderConfig(r))},toList:function(r){return t(e.toList(r))},sendGood:function(r){return t(e.sendGood(r))}}}}})(l.a.create()(P))}}}]);
//# sourceMappingURL=vehicle-order-add.1be15638.chunk.js.map